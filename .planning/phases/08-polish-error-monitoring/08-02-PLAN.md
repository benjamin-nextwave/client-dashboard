---
phase: 08-polish-error-monitoring
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/client/get-client-branding.ts
  - src/app/(client)/dashboard/afspraken/page.tsx
  - src/app/(client)/dashboard/error.tsx
  - src/app/(client)/dashboard/loading.tsx
  - src/app/(operator)/admin/error.tsx
  - src/app/(operator)/admin/loading.tsx
  - src/app/error.tsx
  - src/app/global-error.tsx
autonomous: true

must_haves:
  truths:
    - "Client meetings page redirects to the external URL configured per client by the operator"
    - "If no custom meeting URL is set, meetings page redirects to the default NextWave meetings URL"
    - "All pages have proper loading states for production readiness"
    - "All pages have proper error boundaries for production readiness"
  artifacts:
    - path: "src/lib/client/get-client-branding.ts"
      provides: "Client branding including meeting_url"
      contains: "meeting_url"
    - path: "src/app/(client)/dashboard/afspraken/page.tsx"
      provides: "Server-side redirect to meeting URL"
      contains: "redirect("
    - path: "src/app/(client)/dashboard/error.tsx"
      provides: "Client dashboard error boundary"
      contains: "use client"
    - path: "src/app/(client)/dashboard/loading.tsx"
      provides: "Client dashboard loading skeleton"
      contains: "animate-pulse"
    - path: "src/app/(operator)/admin/error.tsx"
      provides: "Operator admin error boundary"
      contains: "use client"
    - path: "src/app/(operator)/admin/loading.tsx"
      provides: "Operator admin loading skeleton"
      contains: "animate-pulse"
    - path: "src/app/error.tsx"
      provides: "Root error boundary catching route group layout errors"
      contains: "use client"
    - path: "src/app/global-error.tsx"
      provides: "Global error boundary catching root layout errors"
      contains: "use client"
  key_links:
    - from: "src/app/(client)/dashboard/afspraken/page.tsx"
      to: "src/lib/client/get-client-branding.ts"
      via: "getClientBranding() call to get meeting_url"
      pattern: "getClientBranding"
    - from: "src/app/(client)/dashboard/afspraken/page.tsx"
      to: "external meeting URL"
      via: "redirect() with meeting_url or DEFAULT_MEETING_URL"
      pattern: "redirect\\("
---

<objective>
Implement client meetings redirect and add production-ready error boundaries and loading states across all route segments (MEET-01, MEET-02, production polish).

Purpose: The afspraken page is currently a static placeholder that needs to redirect clients to their configured meeting URL. Additionally, the entire app has zero error.tsx or loading.tsx files, meaning any runtime error shows the default Next.js error page and page loads have no visual feedback.

Output: Working meetings redirect + error/loading boundaries on all route segments.
</objective>

<execution_context>
@C:\Users\bstei\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\bstei\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-polish-error-monitoring/08-RESEARCH.md
@src/lib/client/get-client-branding.ts
@src/app/(client)/dashboard/afspraken/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Meetings page redirect with getClientBranding update</name>
  <files>
    src/lib/client/get-client-branding.ts
    src/app/(client)/dashboard/afspraken/page.tsx
  </files>
  <action>
    1. Update `src/lib/client/get-client-branding.ts`:
       - Add `meeting_url` to the select string: change `'id, company_name, primary_color, logo_url'` to `'id, company_name, primary_color, logo_url, meeting_url'`
       - That's it. The return type is inferred from Supabase, so it will automatically include meeting_url as string | null.

    2. Rewrite `src/app/(client)/dashboard/afspraken/page.tsx`:
       - Import { redirect } from 'next/navigation'
       - Import { getClientBranding } from '@/lib/client/get-client-branding'
       - Define const DEFAULT_MEETING_URL = 'https://meetings.nextwave.nl' at module level
       - Make the component async: export default async function AfsprakenPage()
       - Call const client = await getClientBranding()
       - If !client, redirect('/login')
       - Get the meeting URL: const meetingUrl = client.meeting_url || DEFAULT_MEETING_URL
       - Call redirect(meetingUrl) -- this is a server-side redirect, renders NO UI
       - Do NOT render any JSX -- the redirect() call throws internally and prevents any rendering
  </action>
  <verify>
    Run `npx tsc --noEmit` to confirm no type errors (meeting_url is now in the inferred type).
    Grep get-client-branding.ts for "meeting_url" -- should appear in select string.
    Grep afspraken/page.tsx for "redirect" -- should find the import and call.
  </verify>
  <done>
    getClientBranding returns meeting_url field.
    Afspraken page redirects to client's meeting_url if set, otherwise to DEFAULT_MEETING_URL.
    No intermediate UI is rendered -- instant server-side redirect.
  </done>
</task>

<task type="auto">
  <name>Task 2: Error boundaries and loading states across all route segments</name>
  <files>
    src/app/(client)/dashboard/error.tsx
    src/app/(client)/dashboard/loading.tsx
    src/app/(operator)/admin/error.tsx
    src/app/(operator)/admin/loading.tsx
    src/app/error.tsx
    src/app/global-error.tsx
  </files>
  <action>
    1. Create `src/app/(client)/dashboard/error.tsx`:
       - 'use client' directive (REQUIRED for error.tsx)
       - Default export function DashboardError({ error, reset }: { error: Error & { digest?: string }; reset: () => void })
       - Centered layout with min-h-[400px] flex column
       - Title: "Er is iets misgegaan" (h2, text-lg font-semibold text-gray-900)
       - Message: error.message || 'Een onverwachte fout is opgetreden.' (text-sm text-gray-600)
       - Button: "Opnieuw proberen" that calls reset() -- styled with bg-blue-600 text-white rounded-md px-4 py-2 hover:bg-blue-700
       - Use Tailwind classes only, no inline styles (this error boundary is inside the layout which loads Tailwind)

    2. Create `src/app/(client)/dashboard/loading.tsx`:
       - Server component (no 'use client' needed)
       - Export default function DashboardLoading()
       - Skeleton UI with animate-pulse: a title bar (h-8 w-48 rounded bg-gray-200), then a 4-column grid of stat cards (h-24 rounded-lg bg-gray-200), then a large content area (h-64 rounded-lg bg-gray-200)
       - Use responsive grid: grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4

    3. Create `src/app/(operator)/admin/error.tsx`:
       - 'use client' directive
       - Same pattern as client error boundary but with admin-appropriate text
       - Title: "Er is iets misgegaan" (same Dutch text)
       - Message: error.message || 'Een onverwachte fout is opgetreden.'
       - Button: "Opnieuw proberen" calling reset()
       - Same Tailwind styling

    4. Create `src/app/(operator)/admin/loading.tsx`:
       - Server component
       - Skeleton: title bar (h-8 w-48), then a table skeleton (rounded-lg border with 5 rows of h-12 bars with divide-y)
       - Matches the table layout used on admin pages

    5. Create `src/app/error.tsx`:
       - 'use client' directive
       - This catches errors from route group layouts ((client)/layout.tsx, (operator)/layout.tsx)
       - Same centered error pattern with Tailwind
       - Title: "Er is iets misgegaan", message, "Opnieuw proberen" button
       - This is inside root layout so Tailwind is available

    6. Create `src/app/global-error.tsx`:
       - 'use client' directive
       - This catches errors from the ROOT layout itself -- must provide its own html/body tags
       - Use INLINE STYLES only (no Tailwind -- root layout with CSS may not have loaded)
       - html lang="nl", body with centered div
       - Title: "Er is iets misgegaan" (inline font-size, font-weight)
       - Message: "Een onverwachte fout is opgetreden." (inline color gray)
       - Button: "Opnieuw proberen" calling reset() (inline bg blue, white text, border-radius, cursor pointer)
       - See research code example for exact inline style values
  </action>
  <verify>
    Run `npx tsc --noEmit` to confirm no type errors.
    Run `npm run build` to verify all error.tsx files are valid client components and loading.tsx files render.
    Count error.tsx files: should be 4 (dashboard, admin, app root, global-error).
    Count loading.tsx files: should be 2 (dashboard, admin).
  </verify>
  <done>
    4 error boundaries exist: client dashboard, operator admin, app root, global-error.
    2 loading skeletons exist: client dashboard (stat cards layout), operator admin (table layout).
    All error.tsx files are 'use client' components with Dutch text and reset button.
    global-error.tsx uses inline styles (no Tailwind dependency) and provides own html/body.
    All Dutch labels: "Er is iets misgegaan", "Opnieuw proberen", "Een onverwachte fout is opgetreden."
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `npm run build` succeeds
3. getClientBranding select includes meeting_url
4. Afspraken page uses redirect() with no rendered JSX
5. 4 error.tsx files exist (dashboard, admin, app/, global-error)
6. 2 loading.tsx files exist (dashboard, admin)
7. global-error.tsx uses inline styles, not Tailwind
</verification>

<success_criteria>
- Client visiting /dashboard/afspraken is redirected to their meeting_url (or default URL)
- getClientBranding now includes meeting_url in its return value
- Every route segment has appropriate error boundary with Dutch "Opnieuw proberen" button
- Client dashboard and operator admin have loading skeletons matching their page layouts
- global-error.tsx works without any CSS framework loaded (inline styles)
- Build passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/08-polish-error-monitoring/08-02-SUMMARY.md`
</output>
