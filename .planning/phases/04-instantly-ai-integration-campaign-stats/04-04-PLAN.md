---
phase: 04-instantly-ai-integration-campaign-stats
plan: 04
type: execute
wave: 3
depends_on: ["04-02", "04-03"]
files_modified:
  - src/app/(client)/dashboard/_components/contact-status-chart.tsx
  - src/app/(client)/dashboard/_components/icp-charts.tsx
  - src/app/(client)/dashboard/page.tsx
autonomous: true

must_haves:
  truths:
    - "Client sees contact status chart with emailed/not yet emailed/replied/bounced breakdown"
    - "Client sees industry and job title pie/donut charts"
    - "Client sees ICP patterns section filtered to positive leads"
    - "Overzicht page fetches all data server-side and passes to client components"
    - "All data is aggregated -- no campaign names or IDs visible"
  artifacts:
    - path: "src/app/(client)/dashboard/_components/contact-status-chart.tsx"
      provides: "Bar chart showing contact status distribution"
      contains: "use client"
    - path: "src/app/(client)/dashboard/_components/icp-charts.tsx"
      provides: "Pie/donut charts for industry and job title breakdown"
      contains: "PieChart"
    - path: "src/app/(client)/dashboard/page.tsx"
      provides: "Server component fetching all stats and composing dashboard"
      contains: "getMonthlyStats"
  key_links:
    - from: "src/app/(client)/dashboard/page.tsx"
      to: "src/lib/data/campaign-stats.ts"
      via: "imports all query functions"
      pattern: "import.*from.*campaign-stats"
    - from: "src/app/(client)/dashboard/page.tsx"
      to: "src/app/(client)/dashboard/_components/stats-cards.tsx"
      via: "passes stats as props"
      pattern: "<StatsCards"
    - from: "src/app/(client)/dashboard/_components/contact-status-chart.tsx"
      to: "recharts"
      via: "imports BarChart components"
      pattern: "from 'recharts'"
    - from: "src/app/(client)/dashboard/_components/icp-charts.tsx"
      to: "recharts"
      via: "imports PieChart components"
      pattern: "from 'recharts'"
---

<objective>
Build the Recharts chart components and wire up the complete Overzicht dashboard page.

Purpose: This plan delivers the full dashboard experience -- clients see all their campaign statistics, contact breakdowns, and ICP insights in one page, all aggregated across their campaigns without seeing campaign details.

Output: Two chart components and a fully wired Overzicht server component page.
</objective>

<execution_context>
@C:\Users\bstei\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\bstei\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-instantly-ai-integration-campaign-stats/04-RESEARCH.md
@.planning/phases/04-instantly-ai-integration-campaign-stats/04-01-SUMMARY.md
@.planning/phases/04-instantly-ai-integration-campaign-stats/04-02-SUMMARY.md
@.planning/phases/04-instantly-ai-integration-campaign-stats/04-03-SUMMARY.md
@src/app/(client)/layout.tsx
@src/lib/data/campaign-stats.ts
@src/app/(client)/dashboard/_components/stats-cards.tsx
@src/app/(client)/dashboard/_components/contact-list-modal.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Chart components (contact status + ICP)</name>
  <files>src/app/(client)/dashboard/_components/contact-status-chart.tsx, src/app/(client)/dashboard/_components/icp-charts.tsx</files>
  <action>
**contact-status-chart.tsx** -- "use client" component for STAT-06:

Props: `{ data: { status: string; count: number }[] }`

- Use Recharts `BarChart` with `ResponsiveContainer` (width="100%" height={300})
- Horizontal bar chart with status labels on Y axis, count on X axis
- Color coding: "Gemaild" -> blue (#3B82F6), "Beantwoord" -> green (#22C55E), "Gebounced" -> red (#EF4444), "Nog niet gemaild" -> gray (#9CA3AF)
- Include `Tooltip` and `XAxis`/`YAxis` components
- Card wrapper: white bg, rounded-lg, shadow-sm, p-6, with h3 "Contactstatus" title
- Import specific Recharts components only (tree-shaking): `import { BarChart, Bar, XAxis, YAxis, ResponsiveContainer, Tooltip, Cell } from 'recharts'`
- If data is empty, show "Geen data beschikbaar" message instead of empty chart

**icp-charts.tsx** -- "use client" component for STAT-07, STAT-08, STAT-09:

Props:
```typescript
interface ICPChartsProps {
  industryData: { name: string; value: number }[]
  jobTitleData: { name: string; value: number }[]
  positivePatterns: {
    industries: { name: string; value: number }[]
    jobTitles: { name: string; value: number }[]
  }
  brandColor: string
}
```

- Three sections arranged vertically:
  1. **"Sector verdeling"** (STAT-07) -- Donut chart (PieChart with innerRadius) showing industry distribution
  2. **"Functie verdeling"** (STAT-08) -- Donut chart showing job title distribution
  3. **"ICP Vorming"** (STAT-09) -- Two smaller donut charts side by side: "Sectoren bij positieve leads" and "Functies bij positieve leads"

- Each chart section: white bg card, rounded-lg, shadow-sm, p-6
- Use brand color as primary fill, with opacity variations for secondary segments: brandColor at 100%, 80%, 60%, 40%, 20% for top 5, then gray for rest
- Include Legend component below each chart
- Import specific components: `import { PieChart, Pie, Cell, ResponsiveContainer, Tooltip, Legend } from 'recharts'`
- If any data array is empty, show "Geen data beschikbaar" in that section
- Each donut chart uses `innerRadius={60} outerRadius={100}` with `cx="50%" cy="50%"`
  </action>
  <verify>Run `npx tsc --noEmit`. Verify both files are "use client" and import from 'recharts'.</verify>
  <done>Contact status bar chart and ICP donut charts render with Dutch labels, brand color theming, and proper Recharts imports.</done>
</task>

<task type="auto">
  <name>Task 2: Wire up Overzicht page with all components</name>
  <files>src/app/(client)/dashboard/page.tsx</files>
  <action>
Rewrite the existing placeholder Overzicht page as a Server Component that fetches all data and composes the dashboard.

**Data fetching:**
Import all query functions from `@/lib/data/campaign-stats`. Import `getClientBranding` from `@/lib/client/get-client-branding`. Call all functions in parallel using Promise.all for performance:

```typescript
const client = await getClientBranding()
if (!client) redirect('/login')

const [
  monthlyStats,
  unansweredPositive,
  contactCount,
  contactList,
  contactStatus,
  industryBreakdown,
  jobTitleBreakdown,
  positivePatterns,
] = await Promise.all([
  getMonthlyStats(client.id),
  getUnansweredPositiveCount(client.id),
  getContactCount(client.id),
  getContactList(client.id),
  getContactStatusBreakdown(client.id),
  getIndustryBreakdown(client.id),
  getJobTitleBreakdown(client.id),
  getPositiveLeadPatterns(client.id),
])
```

**Layout structure:**
1. Page title: h1 "Overzicht" (keep existing style: text-2xl font-bold text-gray-900)
2. StatsCards component with all stat values and onOpenContactList callback
3. ContactStatusChart with contactStatus data
4. ICPCharts with industryBreakdown, jobTitleBreakdown, positivePatterns, and brandColor from client.primary_color
5. ContactListModal with contactList, controlled by local state

**State management for modal:**
Since this is a Server Component but needs modal state, create a thin "use client" wrapper component `OverzichtDashboard` that:
- Receives all data as props from the server component
- Manages `isModalOpen` state with useState
- Renders StatsCards (with onOpenContactList setting isModalOpen=true), charts, and ContactListModal
- The server page.tsx imports and renders `<OverzichtDashboard {...allProps} />`

Create this wrapper in `src/app/(client)/dashboard/_components/overzicht-dashboard.tsx`.

**Add force-dynamic:** `export const dynamic = 'force-dynamic'` since we need runtime data fetching.

**Files to create/modify:**
- `src/app/(client)/dashboard/page.tsx` -- Server Component, data fetching, renders OverzichtDashboard
- `src/app/(client)/dashboard/_components/overzicht-dashboard.tsx` -- "use client" wrapper managing modal state and composing all child components

Keep the branded accent element from the existing page if it fits, or remove it since real content replaces it.
  </action>
  <verify>Run `npx tsc --noEmit`. Run `npm run build` to verify the page compiles. Check that page.tsx is a Server Component (no "use client") and imports from campaign-stats.ts.</verify>
  <done>Overzicht page fetches all stats server-side, passes to client components, renders complete dashboard with stats cards, alert banner, charts, and contact list modal.</done>
</task>

</tasks>

<verification>
- All chart components compile and use tree-shaken Recharts imports
- Overzicht page fetches from campaign-stats.ts (local Supabase tables, not Instantly API)
- No campaign_id or campaign_name appears anywhere in UI code
- All text is Dutch
- Brand color is passed through from client branding
- Modal state is managed client-side without breaking Server Component data fetching
</verification>

<success_criteria>
Complete Overzicht dashboard renders with: alert banner for unanswered positives, 4 monthly stat cards, contact status chart, industry/job title charts, ICP patterns section, and contact list modal. All data comes from locally synced Supabase tables. All UI text is Dutch. Brand colors applied throughout.
</success_criteria>

<output>
After completion, create `.planning/phases/04-instantly-ai-integration-campaign-stats/04-04-SUMMARY.md`
</output>
